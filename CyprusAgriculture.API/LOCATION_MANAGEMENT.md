# Διαχείριση Γεωγραφικών Τοποθεσιών

## Περιγραφή
Το σύστημα διαχείρισης γεωγραφικών τοποθεσιών επιτρέπει στους διαχειριστές να διαχειρίζονται τις επαρχίες και κοινότητες της Κύπρου.

## Ιεραρχία Τοποθεσιών

Το σύστημα υποστηρίζει 4 επίπεδα γεωγραφικής ιεραρχίας:

1. **Επαρχία** (Province/Region) - Ανώτατο επίπεδο
2. **Δήμος** (Municipality) - Ανήκει σε επαρχία  
3. **Κοινότητα** (Community) - Ανήκει σε δήμο
4. **Τοποθεσία** (Location) - Ανήκει σε κοινότητα

Κάθε τοποθεσία πρέπει να έχει:
- **Ονομασία Τοποθεσίας**: Το συγκεκριμένο όνομα της τοποθεσίας
- **Δήμος**: Ο δήμος στον οποίο ανήκει
- **Κοινότητα**: Η κοινότητα στην οποία ανήκει
- **Επαρχία**: Η επαρχία στην οποία ανήκει

### 3.7.1 Προβολή Μητρώων
- **Ιεραρχική προβολή**: Εμφάνιση επαρχιών με τις αντίστοιχες κοινότητες
- **Προβολή λίστας**: Πλήρης λίστα όλων των τοποθεσιών
- **Φιλτράρισμα**: Φιλτράρισμα ανά επαρχία
- **Αναζήτηση**: Δυνατότητα αναζήτησης τοποθεσιών

### 3.7.2 Προσθήκη Νέας Τοποθεσίας
- **Μανουάλα εισαγωγή**: Φόρμα για προσθήκη νέας κοινότητας ή επαρχίας
- **Υποχρεωτικά πεδία**: Όνομα, Τύπος (Επαρχία/Κοινότητα)
- **Προαιρετικά πεδία**: Κωδικός, Συντεταγμένες (γεωγραφικό πλάτος/μήκος)
- **Επικύρωση**: Έλεγχος για διπλότυπες εγγραφές

### 3.7.3 Εισαγωγή από Αρχείο CSV
- **Υποστηριζόμενη μορφή**: CSV με headers: Όνομα, Επαρχία, Κωδικός
- **Προεπισκόπηση**: Προβολή των πρώτων 10 εγγραφών πριν την εισαγωγή
- **Επικύρωση δεδομένων**: Έλεγχος για:
  - Ελλιπή δεδομένα
  - Μη υπάρχουσες επαρχίες
  - Διπλότυπες εγγραφές
- **Αναφορά αποτελεσμάτων**: Σύνοψη εισαγωγής με λεπτομέρειες

### 3.7.4 Ιστορικό Επεξεργασιών
- **Αυτόματη καταγραφή**: Ημερομηνία δημιουργίας για κάθε τοποθεσία
- **Audit trail**: Παρακολούθηση αλλαγών (υλοποιείται στο backend)

## API Endpoints

### GET /api/Locations/regions
Επιστρέφει όλες τις επαρχίες.

### GET /api/Locations/hierarchy
Επιστρέφει ιεραρχική δομή επαρχιών με κοινότητες.

### POST /api/Locations
Δημιουργεί νέα τοποθεσία.

**Request Body:**
```json
{
  "name": "string",
  "type": "location|community|municipality|region",
  "province": "string (για δήμους, κοινότητες, τοποθεσίες)",
  "municipality": "string (για κοινότητες, τοποθεσίες)", 
  "community": "string (για τοποθεσίες)",
  "code": "string (προαιρετικό)",
  "latitude": "number (προαιρετικό)",
  "longitude": "number (προαιρετικό)"
}
```

### POST /api/Locations/import/preview
Προεπισκόπηση εισαγωγής CSV αρχείου.

### POST /api/Locations/import
Εισαγωγή τοποθεσιών από CSV αρχείο.

## Μορφή CSV Αρχείου

```csv
Όνομα,Δήμος,Κοινότητα,Επαρχία,Κωδικός
Κεντρική Πλατεία,Αγίας Νάπας,Αγία Νάπα,Αμμόχωστος,AN001
Λιμάνι Παραλιμνίου,Παραλιμνίου,Παραλίμνι,Αμμόχωστος,PR002
Παραδοσιακός Οικισμός,Δερύνειας,Δερύνεια,Αμμόχωστος,DR003
```

**Σημειώσεις:**
- Η πρώτη γραμμή πρέπει να περιέχει headers: Όνομα, Δήμος, Κοινότητα, Επαρχία, Κωδικός
- Το πεδίο "Κωδικός" είναι προαιρετικό
- Η επαρχία, ο δήμος και η κοινότητα πρέπει να υπάρχουν ήδη στο σύστημα

## Σφάλματα και Επικύρωση

### Κατά τη δημιουργία:
- **Conflict (409)**: Η τοποθεσία υπάρχει ήδη
- **BadRequest (400)**: Η επαρχία δεν βρέθηκε
- **BadRequest (400)**: Ελλιπή δεδομένα

### Κατά την εισαγωγή CSV:
- **BadRequest (400)**: Λάθος μορφή αρχείου
- **BadRequest (400)**: Κενό αρχείο
- Αναλυτικά σφάλματα στην αναφορά αποτελεσμάτων

## Frontend Components

### LocationManagement
Κεντρικό component για τη διαχείριση τοποθεσιών.

**Props:**
- `language: 'el' | 'en'` - Γλώσσα περιβάλλοντος

**State:**
- Λίστα τοποθεσιών
- Τρόπος προβολής (ιεραρχία/λίστα)
- Φίλτρα και modals

### HierarchyView
Component για ιεραρχική προβολή επαρχιών-κοινοτήτων.

### ListView
Component για προβολή όλων των τοποθεσιών σε πίνακα.

## Βάση Δεδομένων

### Πίνακας: locations
```sql
- id (UUID, Primary Key)
- name (VARCHAR(100), NOT NULL)
- type (VARCHAR(20), NOT NULL) -- 'region', 'community'
- parent_name (VARCHAR(100))
- parent_id (UUID, Foreign Key)
- code (VARCHAR(10))
- latitude (DOUBLE PRECISION)
- longitude (DOUBLE PRECISION)
- is_active (BOOLEAN, NOT NULL)
- created_at (TIMESTAMP, NOT NULL)
```

## Χρήση

1. **Προβολή υπαρχουσών τοποθεσιών**: Χρήση των toggles Ιεραρχία/Λίστα
2. **Προσθήκη νέας τοποθεσίας**: Κλικ στο κουμπί "Προσθήκη Νέας Τοποθεσίας"
3. **Εισαγωγή από αρχείο**: Κλικ στο "Εισαγωγή από Αρχείο", επιλογή CSV, προεπισκόπηση και επιβεβαίωση
4. **Φιλτράρισμα**: Επιλογή επαρχίας από το dropdown